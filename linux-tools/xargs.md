
# xargs使用

这个指令一般叫做管道命令，构造参数等.

它是给命令传递参数的一个过滤器，也是组合多个命令的一个中间工具.

它把数据流分割为一些足够小的部分，以方便过滤器或命令进行处理 。

简单来讲，就是把标准数据流按照特定的分隔符，分割成不同的数据快（或者叫作参数）传递给xargs指定的命令，作为其参数。

## 使用帮助

    man xargs # or info xargs


你也可这里找到一些[中文版本的翻译][1].


## 常用参数

> -d 指定分隔符，注意这里指传入xargs命令的数据分割符，不是xargs传递给后续拼接命令的分隔符，并且如果使用-d\n会保留分隔符'\n'


> -i 用'{}'代替从标准输入传递过来的内容


> -I STRING 使用STRING代替从标准输入传递过来的数据


> -n 限定后续拼接命令行每次接收参数的上限


> -t 显示执行的命令，便于调试


> -p 交互式的确认每次的动作


> -P n 允许最大的线程数目


> -r 忽略空参数的传递，阻止一次空参数指令的执行


> -0 这里是数字0，一般配合find命令中的-print0使用.
输入项以空字符而非空格或 NEWLINE 结束，引号和反斜杠不会特殊对待，即每个字符都按字面意思理解 。
还会禁用文件结束字符串，并将其与其他任何参数一样对待。
该选项在输入项可能包含空格、引号或反斜杠时非常有用。查找 –print0 选项可以生成适合该模式的输入。


## xargs默认的一些规则

xargs默认不会将'\n'保留，而是会忽略掉，可以使用-d\n来保留'\n'字符。

xargs在读取标准输入的时候，会自动忽略空白行，多须的空白和tab这种空白字符。

xargs后不拼接任何命令的时候，默认调用/bin/echo指令。

在终端下，如果使用类似cat或者xargs的指令后，会将所有的终端输入变为标准输入，使用<C-d>表示标准输入结束.


NOTE: 还是再次强调下-d选项

需要区分两个分隔符：

1. xargs 从管道中过滤数据流的分隔符，这个可以自己指定，默认是‘空白字符’，如空白，换行，tab等，
不过如果指定-d\n的话，就会以'\n'来分割，并且会保留'\n'

2. xargs 传递给后续拼接指令的分隔符，这是默认的，就是空格！


## xargs 使用案例

### 忽略空参数

什么是空参数，类似这样

    echo a b c d e f | xargs -p -n 3

添加了-p选项，那么输出是交互的，同样的在交互的时候会允许你选择y或者n，假设你都选n，那么xargs默认使用的/bin/echo程序就没有参数传递，这就是一个空参数的例子。


那应该如何避免空参数执行呢？就使用前文提到的-r选项。

    echo a b c d e f | xargs -p -n 3 -r

### 操作包含空白字符名称的文件

xargs会默认忽略输入的空白符号，那么像下面这样调用指令是不正确的：

    #文件名称为 'Good File Nice.log' --> xargs 将前面这个内容解析为 xargs Good File Nice.log，这并不是我们想要的
    find . -type f -name "*.log" | xargs rm -f

而正确的做法是：

    find . -type f -name "*.log" -print0 | xargs -0 rm -f

### 什么时候省略-i/-I这样的选项

1. xargs的后续拼接命令需要传入的参数并不是在最后面的时候

    ls *.log | xargs -i {} cp {} /data/tmp

2.  一般如果后续的命令有重复使用xargs传入的参数，那么就使用-i/-I选项，毕竟他们也是为了重复利用而设计的。

    ls *.log | xargs -i {} cp {} {}.bak

### 合并多个命令的输出到一行

以下命令会将用圆括号括起来的命令的输出合并到一行，随后将其写入文件结束 log

    example% (logname; date; printf "%s\n" "$0 $*") | xargs >>log

### 使用xargs归档文件

询问用户要归档当前目录中的哪些文件。文件将归档到 arch ; 可以一次归档一个文件，也可以一次归档多个文件：

    ls | xargs -p -L 1 ar -r arch
    ls | xargs -p -L 1 | xargs ar -r arch

### 使用xargs给一些比较工具传递成对参数

命令将以最初键入为命令行参数的后续成对参数执行，一般给对比工具来使用

    echo $* | xargs -n 2 diff


[1]: https://docs.oracle.com/cd/E56344_01/html/E54075/xargs-1.html
